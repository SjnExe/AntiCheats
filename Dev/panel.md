# AddonExe Panel System Documentation

This document outlines the structure, components, and logic of the AddonExe UI panel system. It is intended to serve as a reference for the planned refactoring.

## 1. Panel and Button Definitions

This section lists all available panels and details their buttons, icons, and actions. The primary source for this is `AddonExeBP/scripts/core/panelLayoutConfig.js`.

---

### **`mainPanel`**
- **Title:** `§l§3Panel§r` (Dynamically replaced with `serverName` from config)
- **Parent:** `null`

| Button ID | Text | Icon | Action | Target |
| :--- | :--- | :--- | :--- | :--- |
| `playerManagement` | `§cPlayer Management` | `textures/ui/icon_multiplayer` | `openPanel` | `playerListPanel` |
| `publicPlayerList` | `§2View Players` | `textures/ui/icon_multiplayer` | `openPanel` | `publicPlayerListPanel` |
| `reportManagement` | `§cReport Management` | `textures/ui/WarningGlyph` | `openPanel` | `reportListPanel` |
| `moderation` | `§cModeration` | `textures/ui/hammer_l.png` | `openPanel` | `moderationPanel` |
| `testPanel` | `§eTest Panel` | `textures/ui/icon_setting` | `openPanel` | `testPanel` |
| `bountyList` | `§cBounty List` | `textures/items/netherite_sword.png` | `openPanel` | `bountyListPanel` |
| `rules` | `§eRules` | `textures/items/book_enchanted.png` | `functionCall` | `showRules` |
| `myStats` | `§3My Stats` | `textures/ui/profile_glyph_color.png` | `openPanel` | `myStatsPanel` |
| `helpfulLinks` | `§9Helpful Links` | `textures/items/chain` | `openPanel` | `helpfulLinksPanel` |

---

### **`playerManagementPanel`**
- **Title:** `§l§cActions for {playerName}§r`
- **Parent:** `playerListPanel`

| Button ID | Text | Icon | Action | Target |
| :--- | :--- | :--- | :--- | :--- |
| `teleportToPlayer` | `§8Teleport to Player` | `textures/ui/flyingascend.png` | `functionCall` | `teleportTo` |
| `teleportPlayerHere` | `§8Teleport Player Here`| `textures/ui/flyingdescend.png` | `functionCall` | `teleportHere` |
| `freezePlayer` | `§eFreeze Player` | `textures/ui/lock_color.png` | `functionCall` | `toggleFreeze` |
| `mutePlayer` | `§eMute Player` | `textures/ui/mute_on.png` | `functionCall` | `showMuteForm` |
| `unmutePlayer` | `§2Unmute Player` | `textures/ui/mute_off.png` | `functionCall` | `showUnmuteForm` |
| `kickPlayer` | `§cKick Player` | `textures/ui/icon_import.png` | `functionCall` | `showKickForm` |
| `clearInventory` | `§cClear Inventory` | `textures/ui/trash` | `functionCall` | `clearInventory` |
| `banPlayer` | `§cBan Player` | `textures/ui/hammer_l.png` | `functionCall` | `showBanForm` |

---

### **`moderationPanel`**
- **Title:** `§l§cModeration Tools§r`
- **Parent:** `mainPanel`

| Button ID | Text | Icon | Action | Target |
| :--- | :--- | :--- | :--- | :--- |
| `unbanPlayer` | `§2Unban Player` | `textures/ui/check.png` | `functionCall` | `showUnbanForm` |

---
*Note: Other panels like `publicPlayerActionsPanel`, `reportActionsPanel`, etc., follow the same structure. Panels with `items: []` are populated dynamically at runtime by a builder function in `uiManager.js` (e.g., `buildPlayerListForm`).*


## 2. Core Features & Implementation Notes

This section covers the implementation details of key UI-related features.

### **2.1. Working Standalone Features**
These features are simple and self-contained, making them good candidates for preservation in a refactor.

- **`myStatsPanel`**: This is a "body-only" panel. The content is not made of buttons but is generated by the `addPanelBody` function in `uiManager.js`, which reads the player's own data (`balance`, `rank`, etc.) and displays it.
- **`helpfulLinksPanel`**: Similar to `myStatsPanel`, this panel's body is dynamically generated by `addPanelBody` using link values from `config.js`.
- **`showRules` action**: This is a `functionCall` that triggers the `showRules` function in `uiManager.js`. This function creates a new `ActionFormData` on the fly, populates its body with the rules from `config.js`, and shows it to the player.

### **2.2. Universal Back Button**
The back button has two different implementations, creating an inconsistency:

1.  **Static Panels**: For most panels defined with items in `panelLayoutConfig.js`, the `getMenuItems` function in `uiManager.js` automatically prepends a "Back" button if the panel definition has a `parentPanelId`. This is the "universal" implementation.
2.  **Dynamic List Panels**: For panels whose content is generated by a builder function (e.g., `buildPlayerListForm` for the player list), the "Back" button is hardcoded directly inside that builder function. This is a separate, manual implementation.

### **2.3. Opening UI from Chat Commands**
The user mentioned a "specialised technique" to open the panel, which is implemented in the `uiWait` function in `AddonExeBP/scripts/core/utils.js`.

- **Command:** The `!panel` command (with aliases `!ui` and `!gui`) is defined in `AddonExeBP/scripts/modules/commands/panel.js`. Its `execute` function simply calls `showPanel(player, 'mainPanel')`.
- **The Problem:** When a player runs a command, the chat screen is open. If you immediately try to show a UI form, the `show()` promise will reject with `cancelationReason: 'UserBusy'`.
- **The Solution (`uiWait`):**
    1.  It first tries to `form.show(player)` normally. If it succeeds or is canceled for any reason other than `UserBusy`, it returns the result.
    2.  If the reason is `UserBusy`, it sends the player a one-time message: `§eOpening UI... please close chat to view.§r`.
    3.  It then enters a `while` loop, repeatedly trying to call `form.show(player)` until it no longer returns `UserBusy`, or until a timeout of 1 minute is reached.

This ensures that the UI panel appears as soon as the player closes the chat screen after running the command.

## 3. Proposed Refactoring: Command-Based Actions

This section will outline the proposal to refactor UI actions to use the chat command backend.
