# AddonExe Panel System Documentation

This document outlines the structure, components, and logic of the AddonExe UI panel system.

## 1. Panel and Button Definitions

This section lists all available panels and details their buttons, icons, and actions. The primary source for this is `AddonExeBP/scripts/core/panelLayoutConfig.js`.

---

### **`mainPanel`**
- **Title:** `§l§3Panel§r` (Dynamically replaced with `serverName` from config)
- **Parent:** `null`

| Button ID | Text | Icon | Action | Target |
| :--- | :--- | :--- | :--- | :--- |
| `reportManagement` | `§cReport Management` | `textures/ui/WarningGlyph` | `openPanel` | `reportListPanel` |
| `moderation` | `§cModeration` | `textures/ui/hammer_l.png` | `openPanel` | `moderationPanel` |
| `bountyList` | `§cBounty List` | `textures/items/netherite_sword.png` | `openPanel` | `bountyListPanel` |
| `rules` | `§eRules` | `textures/items/book_enchanted.png` | `functionCall` | `showRules` |
| `myStats` | `§3My Stats` | `textures/ui/profile_glyph_color.png` | `openPanel` | `myStatsPanel` |
| `helpfulLinks` | `§9Helpful Links` | `textures/items/chain` | `openPanel` | `helpfulLinksPanel` |

---

### **`moderationPanel`**
- **Title:** `§l§cModeration Tools§r`
- **Parent:** `mainPanel`

| Button ID | Text | Icon | Action | Target |
| :--- | :--- | :--- | :--- | :--- |
| `unbanPlayer` | `§2Unban Player` | `textures/ui/check.png` | `functionCall` | `showUnbanForm` |

---
*Note: Panels with `items: []` are populated dynamically at runtime by a builder function in `uiManager.js`.*


## 2. Core Features & Implementation Notes

This section covers the implementation details of key UI-related features.

### **2.1. Working Standalone Features**
- **`myStatsPanel`**: This is a "body-only" panel. The content is not made of buttons but is generated by the `addPanelBody` function in `uiManager.js`, which reads the player's own data (`balance`, `rank`, etc.) and displays it.
- **`helpfulLinksPanel`**: Similar to `myStatsPanel`, this panel's body is dynamically generated by `addPanelBody` using link values from `config.js`.
- **`showRules` action**: This is a `functionCall` that triggers the `showRules` function in `uiManager.js`. This function creates a new `ActionFormData` on the fly, populates its body with the rules from `config.js`, and shows it to the player.

### **2.2. Universal Back Button**
- **Static Panels**: For most panels, the `getMenuItems` function in `uiManager.js` automatically prepends a "Back" button if the panel definition has a `parentPanelId`.
- **Dynamic List Panels**: For panels whose content is generated by a builder function, the "Back" button is hardcoded directly inside that builder function.

### **2.3. Opening Panels from a Command**
- **The Command**: The command is defined in `AddonExeBP/scripts/modules/commands/panel.js`. When a player types `!panel` (or `!ui`/`!gui`), the `execute` function is run, which simply calls `showPanel(player, 'mainPanel')`.
- **The `UserBusy` Problem**: Minecraft's API prevents a UI from being shown while the player has the chat screen open. Attempting to do so will result in a `UserBusy` error.
- **The `utils.uiWait` Solution**: The `uiManager` uses a helper function, `utils.uiWait`, to show forms. This function contains a special loop: if it detects the `UserBusy` error, it waits and retries showing the form until the player closes the chat. This provides a seamless experience, as the panel appears the moment the player exits the chat interface.

## 3. Removed Features (For Future Re-implementation)

As of version 1.4.51, the following features were temporarily removed to resolve a persistent, environment-specific bug that caused client crashes. The underlying code has been removed from `panelLayoutConfig.js` and `uiManager.js`. This section serves as a reference for their future re-implementation.

### **3.1. Player Management Panel**

-   **Trigger**: A "Player Management" button on the main panel.
-   **Flow**:
    1.  Opened `playerListPanel`, a dynamic list of all online players.
    2.  Selecting a player opened `playerManagementPanel` for that specific player.
-   **Functionality (`playerManagementPanel`)**: This panel provided administrators with a suite of moderation tools for the selected player, including:
    -   Teleport to Player
    -   Teleport Player Here
    -   Freeze/Unfreeze Player
    -   Mute/Unmute Player
    -   Kick Player
    -   Clear Inventory
    -   Ban Player

### **3.2. Public Player List & Actions**

-   **Trigger**: A "View Players" button on the main panel.
-   **Flow**:
    1.  Opened `publicPlayerListPanel`, a dynamic list of online players visible to everyone.
    2.  Selecting a player opened `publicPlayerActionsPanel`.
-   **Functionality (`publicPlayerActionsPanel`)**: This panel allowed any player to perform public actions on another player, including:
    -   Send TPA Request
    -   Pay Player
    -   Set a Bounty
    -   Report Player

### **3.3. Bounty Actions**

-   **Trigger**: Selecting a player from the `bountyListPanel`.
-   **Original Flow**: Opened a `bountyActionsPanel` with options to add to or reduce the selected bounty.
-   **Current Flow**: The `bountyActionsPanel` has been removed. Clicking a player on the bounty list now navigates back to the main menu.
